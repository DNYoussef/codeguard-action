# SOC 2 Type II Controls Rubric Pack
# GuardSpine Governance Evidence Requirements
#
# Based on AICPA Trust Services Criteria
# https://www.aicpa.org/resources/article/soc-2-trust-services-criteria

name: "SOC 2 Type II Controls"
version: "1.0.0"
description: "Rubric pack for SOC 2 compliance evidence generation"

rules:
  # CC6 - Logical and Physical Access Controls
  - id: "SOC2-CC6.1"
    category: "CC-AccessControl"
    name: "Change Management"
    description: "Changes to infrastructure, data, software, and procedures are authorized"
    severity: "high"
    patterns:
      - "(?:change|modify|update|alter).*(?:security|auth|permission|access|credential)"
      - "(?:firewall|network.*rule|port.*open|ssl.*config|tls.*config)"

  - id: "SOC2-CC6.2"
    category: "CC-AccessControl"
    name: "Access Provisioning"
    description: "New logical access is authorized based on job requirements"
    severity: "high"
    patterns:
      - "add.*user|create.*account|grant.*permission|role.*assign"

  - id: "SOC2-CC6.3"
    category: "CC-AccessControl"
    name: "Access Removal"
    description: "Logical access is removed when no longer needed"
    severity: "medium"
    patterns:
      - "remove.*user|delete.*account|revoke.*permission|disable"

  # CC7 - System Operations
  - id: "SOC2-CC7.1"
    category: "CC-Operations"
    name: "Vulnerability Management"
    description: "Vulnerabilities are identified and addressed"
    severity: "high"
    patterns:
      - "CVE-|vulnerability|security.*fix|patch"

  - id: "SOC2-CC7.2"
    category: "CC-Operations"
    name: "Incident Response"
    description: "Security incidents are detected, reported, and corrected"
    severity: "critical"
    patterns:
      - "\\bincident\\b.*(?:response|report|detect|handle)"
      - "\\bbreach\\b.*(?:notify|report|detect)"
      - "\\bcompromise[d]?\\b.*(?:account|system|server)"
      - "\\bmalicious\\b.*(?:input|request|payload|actor)"

  # CC8 - Change Management
  - id: "SOC2-CC8.1"
    category: "CC-ChangeManagement"
    name: "Infrastructure Changes"
    description: "Changes to infrastructure are authorized, tested, and documented"
    severity: "high"
    patterns:
      - "terraform|kubernetes|docker|aws|azure|gcp"

  # A1 - Availability
  - id: "SOC2-A1.1"
    category: "Availability"
    name: "Capacity Planning"
    description: "System capacity meets operational requirements"
    severity: "medium"
    patterns:
      - "scale|capacity|limit|quota|threshold"

  # PI1 - Processing Integrity
  - id: "SOC2-PI1.1"
    category: "ProcessingIntegrity"
    name: "Data Validation"
    description: "Input validation ensures data integrity"
    severity: "high"
    patterns:
      - "validate|sanitize|escape|encode|parse.*input"

  # C1 - Confidentiality
  - id: "SOC2-C1.1"
    category: "Confidentiality"
    name: "Data Classification"
    description: "Confidential information is properly classified and protected"
    severity: "critical"
    patterns:
      - "encrypt|decrypt|secret|private|confidential|sensitive"

  - id: "SOC2-C1.2"
    category: "Confidentiality"
    name: "Key Management"
    description: "Cryptographic keys are properly managed"
    severity: "critical"
    patterns:
      - "key.*rotation|api.*key|secret.*key|private.*key|cert"
