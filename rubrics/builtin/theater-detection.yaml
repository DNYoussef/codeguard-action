# Theater Detection Rubric
# Detecting "fake quality" - practices that appear valuable but don't add real value
#
# Quality Theater: Activities that create the appearance of quality
# without actually improving software reliability or maintainability.
#
# Based on research into:
# - Cargo cult programming
# - Security theater
# - Compliance theater
# - Test theater

name: theater-detection
version: "1.0"
description: "Detect quality theater - fake practices that appear valuable but aren't"

thresholds:
  max_theater_risk: 0.20  # Maximum 20% theater indicators

rules:
  # Test Theater
  - id: THR-001
    name: empty_test_bodies
    category: test_theater
    severity: critical
    description: "Tests that pass but don't actually verify anything"
    guidance: |
      Empty tests provide false confidence:
      - Tests must have assertions
      - Avoid assertTrue(True)
      - Check for meaningful conditions
      - Review test coverage quality, not just quantity
    patterns:
      - "def test_[a-z_]+\\([^)]*\\):\\s*\\n\\s*pass"
      - "assert\\s+True"
      - "assert\\s+1\\s*==\\s*1"
      - "(?:it|test)\\(['\"].*['\"].*\\{\\s*\\}"
      - "expect\\(true\\)\\.toBe\\(true\\)"
      - "expect\\(1\\)\\.toBe\\(1\\)"

  - id: THR-002
    name: assertion_free_tests
    category: test_theater
    severity: high
    description: "Tests that run code but don't assert outcomes"
    guidance: |
      Every test needs verification:
      - Call without assertion is not a test
      - At least one assert per test
      - Prefer specific assertions
    patterns:
      - "def test_[a-z_]+\\([^)]*\\):(?!.*assert)"
      - "(?:it|test)\\(['\"].*['\"],\\s*(?:async\\s+)?\\([^)]*\\)\\s*=>\\s*\\{(?!.*expect)"

  - id: THR-003
    name: tautological_tests
    category: test_theater
    severity: high
    description: "Tests that verify implementation rather than behavior"
    guidance: |
      Avoid testing implementation:
      - Don't test private methods
      - Don't mock the system under test
      - Focus on public interfaces
      - Test behavior, not structure
    patterns:
      - "mock\\.assert_called"
      - "@patch.*\\n.*@patch.*\\n.*@patch"

  - id: THR-004
    name: coverage_gaming
    category: test_theater
    severity: high
    description: "Artificial coverage inflation without meaningful tests"
    guidance: |
      Coverage without quality is theater:
      - Don't write tests just for coverage
      - Mutation testing reveals real coverage
      - Branch coverage > line coverage
      - Critical path coverage matters most
    patterns:
      - "# pragma: no cover"
      - "# nocover"
      - "istanbul ignore"
      - "c8 ignore"
      - "v8 ignore"

  # Documentation Theater
  - id: THR-005
    name: auto_generated_docs
    category: doc_theater
    severity: medium
    description: "Documentation that just restates code without adding value"
    guidance: |
      Docs should add context:
      - "Returns: the return value" is useless
      - Explain why, not what
      - Document edge cases
      - Include examples
    patterns:
      - "Returns:\\s*\\n\\s*[A-Z][a-z]+:\\s*The\\s+[a-z_]+"
      - ":returns:\\s+the\\s+[a-z_]+"

  - id: THR-006
    name: placeholder_comments
    category: doc_theater
    severity: low
    description: "Comments that don't add information"
    guidance: |
      Remove noise comments:
      - "# TODO" without details
      - "# FIXME" without context
      - "# increment i" next to i += 1
      - Let code speak for itself
    patterns:
      - "#\\s*TODO\\s*$"
      - "#\\s*FIXME\\s*$"
      - "#\\s*[Ii]ncrement"
      - "#\\s*[Ll]oop through"
      - "//\\s*TODO\\s*$"
      - "//\\s*FIXME\\s*$"
      - "//\\s*[Ii]ncrement"
      - "//\\s*[Ll]oop through"

  # Security Theater
  - id: THR-007
    name: security_by_obscurity
    category: security_theater
    severity: critical
    description: "Security measures that rely on hidden implementation"
    guidance: |
      Real security is transparent:
      - Don't rely on secret algorithms
      - Use standard cryptography
      - Publish your security model
      - Assume attackers know the code
    patterns:
      - "secret_key\\s*=\\s*['\"][^'\"]+['\"]"
      - "password\\s*=\\s*['\"][^'\"]+['\"]"
      - "(?:secretKey|apiKey)\\s*[=:]\\s*['\"][^'\"]+['\"]"
      - "# secret"
      - "# hidden"
      - "// secret"
      - "// hidden"

  - id: THR-008
    name: weak_validation
    category: security_theater
    severity: high
    description: "Input validation that appears secure but isn't"
    guidance: |
      Validation must be comprehensive:
      - Client-side only is theater
      - Blocklists are incomplete
      - Use allowlists instead
      - Validate at trust boundaries
    patterns:
      - "\\bblacklist\\b"
      - "\\bblocklist\\b"

  # Compliance Theater
  - id: THR-009
    name: checkbox_compliance
    category: compliance_theater
    severity: medium
    description: "Compliance activities that meet letter but not spirit"
    guidance: |
      Compliance should improve quality:
      - Don't just check boxes
      - Understand the intent
      - Implement meaningful controls
      - Measure effectiveness
    patterns:
      - "#\\s*compliant"
      - "#\\s*SOC2"
      - "#\\s*PCI"
      - "//\\s*compliant"
      - "//\\s*SOC2"
      - "//\\s*PCI"

  - id: THR-010
    name: audit_artifacts_only
    category: compliance_theater
    severity: medium
    description: "Artifacts created only for auditors, not used operationally"
    guidance: |
      Documentation should be useful:
      - If it's only for audit, question its value
      - Integrate compliance into workflow
      - Automate evidence collection
      - Make artifacts living documents

  # Process Theater
  - id: THR-011
    name: ceremony_over_substance
    category: process_theater
    severity: medium
    description: "Heavy processes that add overhead without value"
    guidance: |
      Process should help, not hinder:
      - Meetings that could be emails
      - Reviews without feedback
      - Approvals without inspection
      - Retrospectives without action
    indicators:
      - "approved_by"
      - "reviewed_by"
      - "sign_off"

  - id: THR-012
    name: metric_gaming
    category: process_theater
    severity: high
    description: "Optimizing for metrics rather than outcomes"
    guidance: |
      Goodhart's Law applies:
      - Velocity gaming (small stories)
      - Coverage gaming (trivial tests)
      - Lines of code gaming
      - Focus on outcomes, not metrics
    indicators:
      - Small uniform story points
      - Sudden coverage jumps
      - Commit splitting

  # Code Theater
  - id: THR-013
    name: design_pattern_abuse
    category: code_theater
    severity: medium
    description: "Overuse of design patterns where simpler solutions work"
    guidance: |
      Patterns should solve problems:
      - YAGNI (You Aren't Gonna Need It)
      - Don't add abstraction for abstraction's sake
      - Simple > Complex > Complicated
      - Patterns have costs
    patterns:
      - "Factory.*Factory"
      - "Abstract.*Abstract"
      - "Manager.*Manager"

  - id: THR-014
    name: premature_optimization
    category: code_theater
    severity: medium
    description: "Optimization without evidence of need"
    guidance: |
      Optimize based on data:
      - Profile before optimizing
      - Readability > minor performance
      - Document why optimization needed
      - Keep simple version as reference
    patterns:
      - "#\\s*[Oo]ptimized"
      - "#\\s*[Pp]erformance"
      - "//\\s*[Oo]ptimized"
      - "//\\s*[Pp]erformance"

  - id: THR-015
    name: cargo_cult_code
    category: code_theater
    severity: high
    description: "Copying patterns without understanding"
    guidance: |
      Understand before copying:
      - Know why patterns work
      - Adapt to your context
      - Don't blindly follow examples
      - Question received wisdom
    patterns:
      - "#\\s*[Cc]opied from"
      - "#\\s*[Ff]rom [Ss]tack[Oo]verflow"
      - "//\\s*[Cc]opied from"
      - "//\\s*[Ff]rom [Ss]tack[Oo]verflow"

