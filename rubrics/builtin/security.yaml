name: security
version: "1.0"
description: "Security-focused rules for detecting common vulnerabilities"
rules:
  - id: SEC-001
    name: no_hardcoded_secrets
    category: security
    severity: critical
    description: "No hardcoded secrets or API keys"
    patterns:
      - "password\\s*=\\s*[\"'][^\"']+[\"']"
      - "api_key\\s*=\\s*[\"'][^\"']+[\"']"
      - "secret\\s*=\\s*[\"'][^\"']+[\"']"
      - "token\\s*=\\s*[\"'][a-zA-Z0-9_-]{20,}[\"']"
      - "AWS_SECRET_ACCESS_KEY\\s*=\\s*[\"'][^\"']+[\"']"
    exceptions:
      - "*_test.py"
      - "test_*.py"
      - "**/tests/**"
      - "*.example"
      - "*.template"

  - id: SEC-002
    name: no_sql_injection
    category: security
    severity: critical
    description: "No SQL injection vulnerabilities"
    patterns:
      - "execute\\([^)]*%[^)]*\\)"
      - "execute\\([^)]*\\.format\\("
      - 'f"[^"]*SELECT[^"]*\\{[^}]+\\}'
      - "f'[^']*SELECT[^']*\\{[^}]+\\}'"
    exceptions:
      - "*_test.py"
      - "test_*.py"

  - id: SEC-003
    name: no_command_injection
    category: security
    severity: critical
    description: "No command injection vulnerabilities"
    patterns:
      - "os\\.system\\([^)]*\\+[^)]*\\)"
      - "os\\.system\\([^)]*%[^)]*\\)"
      - "subprocess\\..*shell\\s*=\\s*True"
      - "eval\\([^)]*input"
      - "exec\\([^)]*input"
    exceptions:
      - "*_test.py"
      - "test_*.py"

  - id: SEC-004
    name: no_insecure_deserialization
    category: security
    severity: high
    description: "Avoid insecure deserialization"
    patterns:
      - "pickle\\.loads?\\("
      - "yaml\\.load\\([^)]*Loader\\s*=\\s*None"
      - "yaml\\.load\\([^,)]+\\)"
    exceptions:
      - "*_test.py"

  - id: SEC-005
    name: no_debug_in_production
    category: security
    severity: high
    description: "No debug statements in production code"
    patterns:
      - "DEBUG\\s*=\\s*True"
      - "app\\.debug\\s*=\\s*True"
      - "print\\([^)]*password"
      - "print\\([^)]*secret"
      - "print\\([^)]*token"
    exceptions:
      - "*_test.py"
      - "test_*.py"
      - "**/tests/**"
      - "settings_dev.py"
      - "config_dev.py"
